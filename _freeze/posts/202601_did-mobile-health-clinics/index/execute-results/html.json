{
  "hash": "ead21d6e3d79e538e142765cee94b5e3",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Understanding Difference-in-Differences: Mobile Health Clinics in Rural India\"\ndescription: \"A practical guide to DiD estimation with Stata, exploring causal inference in health policy evaluation\"\nauthor: \"Nadhira A. Hendra\"\ncategories: [stata, difference-in-difference, development-economics]\ndate: \"January 15, 2026\"\nformat:\n  html:\n    code-fold: true\n    toc: true\n    toc-depth: 3\nexecute:\n  eval: true\n  echo: true\n---\n\n# Introduction\n\nThis analysis started as one of my class assignments in Economic Development at Columbia. The task was to think through the design and estimation of a Difference-in-Differences (DiD) study evaluating mobile health clinics on prenatal care utilization in rural Rajasthan, India.\n\nUnlike my previous post on World Bank indicators (which was purely correlational), this one dives into causal inference. **DiD lets us estimate treatment effects when we have observational data before and during the period of intervention**.\n\nDiD is one of the most widely used quasi-experimental method in empirical economics. It is particularly valuable in context where randomized controlled trial may be infeasible. However, this method also often use in combination with randomization because the **key insight of DiD is that we can observe the change over time in untreated units**, adjusting any baseline difference between control and treatment groups. \n\nIn this post I'll walk through the design, the assumptions to make, and show how to implement it in Stata. This post serves as both a personal reference and hopefully can be a useful resource for others learning causal inference methods.\n\n# The Problem\n\nImagine researchers want to evaluate a mobile health clinic program that began operating in treatment village in January 2023. The intervention involves sending mobile clinics to **randomly selected villages once per week**, offering free prenatal checkups, basic medications, and health education to pregnant women.\n\nThe researchers was able to collected data on prenatal care visits:\n\n- **Before**: 2022 (pre-treatment)\n- **After**: 2023 (post-treatment)\n\n# Why Randomize at the Village Level?\n\nA natural question: why not randomize at the individual level? Why assign entire villages to treatment or control?\n\nThe answer lies in avoiding SUTVA (Stable Unit Treatment Value Assumption) violations. If we randomized at individual levels, meaning that in one village there could be a group of woman that is assigned to treatment and another groups that is assigned to control, we'd face several problems:\n\n1. **Spillover effects**: If a woman in the treatment group shares information about prenatal benefits with her neighbor in the control group, or if the control woman sees treatment women getting checkups and decides to seek care herself, we'd underestimate the true treatment effect.\n\n2. **Correlated outcomes**: Women within the same village are more alike than women across villages (similar cultural norms, access to facilities, socioeconomic conditions). This means observations aren't truly independent.\n\n3. **Understated standard errors**: Our regression assumes each observation contributes equally independent information. When observations are clustered, we have less effective information than the sample size suggests.\n\nBy randomizing at the village level, we cleanly separate treatment and control groups and avoid these contamination issues.\n\n# The DiD Framework\n\n## The 2x2 Grid\n\nWhat I like about DiD is the simplicity. To be able to calculate the result we need four group means:\n\n|                | Control Villages | Treatment Villages |\n|----------------|------------------|--------------------|\n| **Before (2022)** | $\\bar{Y}_{00}$   | $\\bar{Y}_{10}$     |\n| **After (2023)**  | $\\bar{Y}_{01}$   | $\\bar{Y}_{11}$     |\n\nWhere:\n\n- $\\bar{Y}_{00}$ = average prenatal visits before treatment in control group\n- $\\bar{Y}_{01}$ = average prenatal visits after treatment in control group\n- $\\bar{Y}_{10}$ = average prenatal visits before treatment in treatment group\n- $\\bar{Y}_{11}$ = average prenatal visits after treatment in treatment group\n\nThe DiD estimator is:\n\n$$\\text{DiD} = (\\bar{Y}_{11} - \\bar{Y}_{10}) - (\\bar{Y}_{01} - \\bar{Y}_{00})$$\n\nIn words: take the change in the treatment group, subtract the change in the control group.\n\n## The Regression Equation\n\nWe can express this in regression form:\n\n$$Y_{it} = \\alpha + \\beta \\cdot Treatment_i + \\gamma \\cdot After_t + \\tau \\cdot (Treatment_i \\times After_t) + \\epsilon_{it}$$\n\nWhere:\n\n- $\\alpha$: baseline mean for control group in the pre-period\n- $\\beta$: time-invariant difference between treatment and control (selection effect)\n- $\\gamma$: time trend common to both groups (what would have happened anyway)\n- $\\tau$ (**the DiD estimate**) : the causal effect of mobile clinics on prenatal visits\n\nThe coefficient $\\tau$ is what we care about. It captures the additional change in the treatment group beyond what the control group experienced.\n\n# Stata Implementation\n\nLet me show how this would look in practice with simulated data.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nlibrary(Statamarkdown)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nStata found at /Applications/StataNow/StataBE.app/Contents/MacOS/StataBE\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe 'stata' engine is ready to use.\n```\n\n\n:::\n\n```{.r .cell-code  code-fold=\"false\"}\nknitr::opts_chunk$set(\n  warning=FALSE,\n  message=FALSE,\n  engine.path = list(stata = \"/Applications/StataNow/StataBE.app/Contents/MacOS/StataBE\")\n  )\n```\n:::\n\n\n## Simulating the Data\n\nFor illustration, I'll create a dataset that mimics what researchers might have collected.\n\n\n::: {.cell}\n\n```{.stata .cell-code}\nclear\n\n* Set seed for reproducibility\nset seed 12345\n\n* Create village-level data\nset obs 100\ngenerate village_id = _n\ngenerate treatment = (village_id <= 50)\n\n* Expand to woman-level (10 women per village)\nexpand 10\nbysort village_id: generate woman_id = _n\n\n* Expand to panel (before and after)\nexpand 2\nbysort village_id woman_id: generate period = _n - 1\nlabel define period_lbl 0 \"Before (2022)\" 1 \"After (2023)\"\nlabel values period period_lbl\n\n* Generate outcome with DiD structure\n* Base: 2 visits on average\n* Treatment villages slightly lower at baseline: -0.2\n* Time trend for everyone: +0.3\n* Treatment effect: +0.8 visits\n\ngenerate prenatal_visits = 2 + ///\n    (-0.2) * treatment + ///\n    (0.3) * period + ///\n    (0.8) * treatment * period + ///\n    rnormal(0, 0.8)\n\n* Round to integers (can't have fractional visits)\nreplace prenatal_visits = round(prenatal_visits, 1)\nreplace prenatal_visits = 0 if prenatal_visits < 0\n\nsave \"did_simulation.dta\", replace\n\ndescribe\n```\n\n\n::: {.cell-output .cell-output-stdout}\n\n```\nNumber of observations (_N) was 0, now 100.\n\n\n\n(900 observations created)\n\n\n(1,000 observations created)\n\n\n\n\n\n(2,000 real changes made)\n\n(1 real change made)\n\nfile did_simulation.dta saved\n\n\nContains data from did_simulation.dta\n Observations:         2,000                  \n    Variables:             5                  15 Jan 2026 16:04\n-------------------------------------------------------------------------------------------\nVariable      Storage   Display    Value\n    name         type    format    label      Variable label\n-------------------------------------------------------------------------------------------\nvillage_id      float   %9.0g                 \ntreatment       float   %9.0g                 \nwoman_id        float   %9.0g                 \nperiod          float   %13.0g     period_lbl\n                                              \nprenatal_visits float   %9.0g                 \n-------------------------------------------------------------------------------------------\nSorted by: village_id  woman_id\n```\n\n\n:::\n:::\n\n\n## Computing Group Means\n\n\n::: {.cell}\n\n```{.stata .cell-code}\nuse \"did_simulation.dta\", clear\n\n* Create the 2x2 table\ntable treatment period, statistic(mean prenatal_visits) statistic(sd prenatal_visits)\n```\n\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                       |                   period                \n                       |  Before (2022)   After (2023)      Total\n-----------------------+-----------------------------------------\ntreatment              |                                         \n  0                    |                                         \n    Mean               |           2.06          2.332      2.196\n    Standard deviation |       .8589969       .8527781   .8662184\n  1                    |                                         \n    Mean               |           1.81          2.946      2.378\n    Standard deviation |        .831434       .8789933   1.026728\n  Total                |                                         \n    Mean               |          1.935          2.639      2.287\n    Standard deviation |       .8541104       .9184348   .9539843\n-----------------------------------------------------------------\n```\n\n\n:::\n:::\n\n\n## Running the DiD Regression\n\n\n::: {.cell}\n\n```{.stata .cell-code}\nuse \"did_simulation.dta\", clear\n\n* Generate interaction term\ngenerate treat_post = treatment * period\n\n* DiD regression\nregress prenatal_visits treatment period treat_post\n\n* Store coefficients for interpretation\nscalar tau_hat = _b[treat_post]\ndisplay \"DiD Estimate (tau): \" tau_hat\n```\n\n\n::: {.cell-output .cell-output-stdout}\n\n```\n      Source |       SS           df       MS      Number of obs   =     2,000\n-------------+----------------------------------   F(3, 1996)      =    162.82\n       Model |     357.682         3  119.227333   Prob > F        =    0.0000\n    Residual |     1461.58     1,996  .732254509   R-squared       =    0.1966\n-------------+----------------------------------   Adj R-squared   =    0.1954\n       Total |    1819.262     1,999  .910086043   Root MSE        =    .85572\n\n------------------------------------------------------------------------------\nprenatal_v~s | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]\n-------------+----------------------------------------------------------------\n   treatment |       -.25   .0541204    -4.62   0.000    -.3561384   -.1438616\n      period |       .272   .0541204     5.03   0.000     .1658616    .3781384\n  treat_post |       .864   .0765378    11.29   0.000     .7138976    1.014102\n       _cons |       2.06   .0382689    53.83   0.000     1.984949    2.135051\n------------------------------------------------------------------------------\n\n\nDiD Estimate (tau): .864\n```\n\n\n:::\n:::\n\n\nThe coefficient on `treat_post` is our DiD estimate. In this simulated data, mobile clinics increased prenatal visits by approximately 0.8 visits—close to the true effect we built into the simulation.\n\n## Clustering Standard Errors\n\nSince treatment is assigned at the village level, we should cluster our standard errors accordingly:\n\n\n::: {.cell}\n\n```{.stata .cell-code}\nuse \"did_simulation.dta\", clear\n\ngenerate treat_post = treatment * period\n\n* DiD regression with clustered standard errors\nregress prenatal_visits treatment period treat_post, cluster(village_id)\n```\n\n\n::: {.cell-output .cell-output-stdout}\n\n```\nLinear regression                               Number of obs     =      2,000\n                                                F(3, 99)          =     133.22\n                                                Prob > F          =     0.0000\n                                                R-squared         =     0.1966\n                                                Root MSE          =     .85572\n\n                           (Std. err. adjusted for 100 clusters in village_id)\n------------------------------------------------------------------------------\n             |               Robust\nprenatal_v~s | Coefficient  std. err.      t    P>|t|     [95% conf. interval]\n-------------+----------------------------------------------------------------\n   treatment |       -.25   .0534681    -4.68   0.000    -.3560923   -.1439077\n      period |       .272   .0542785     5.01   0.000     .1642996    .3797004\n  treat_post |       .864    .080151    10.78   0.000      .704963    1.023037\n       _cons |       2.06    .038061    54.12   0.000     1.984479    2.135521\n------------------------------------------------------------------------------\n```\n\n\n:::\n:::\n\n\nNotice how the standard errors change when we account for clustering. This is important—ignoring clustering can lead to overconfidence in our estimates.\n\n# Assumption\n## Parallel Trends\n\n::: {.callout-warning}\n## The Key Assumption\nDiD requires that without treatment, both groups would have followed the same trend. This is called the **parallel trends assumption**. It's untestable in the treatment period, but we can check whether trends were parallel before treatment.\n:::\n\nIn our example, suppose treatment villages had 2.1 prenatal visits in 2022 while control villages had 2.3. This baseline difference doesn't invalidate DiD—the method accounts for level differences by looking at *changes* rather than absolute levels.\n\nWhat would be concerning is if the groups were on different trajectories before treatment. If we had data from 2020 and 2021, we could test this by:\n\n1. **Visual inspection**: Plot average prenatal visits over time for both groups. The lines should be roughly parallel before 2023.\n\n2. **Placebo test**: Run DiD on the pre-treatment periods. If we find a \"treatment effect\" before treatment actually happened, something is wrong.\n\n## Additional Assumption \nSpecifically with this case study,  we also need to make some additional assumption :\n\n1. **No Spillovers** : No spillovers between villages (which we address by cluster randomization in\nvillage levels) \n2. **No anticipation effects** : Which assume that women didn’t change behavior before mobile\nclinic arrived\n\n# Conclusion\n\nDifference-in-Differences is a method where we compare changes over time between groups that did and didn't receive treatment. With DiD we also able to remove both time-invariant differences between groups(existing sifference between control and treatment before the intervention started).\n\nThe method requires careful attention to **Parallel trends** assumptionwhich can't be tested directly but can be signalled by analysing pre-treatment data.\n\nAdditionally, consider the cost and logistics, we also need to consider the **Unit of randomization** to cluster at the village level to avoid SUTVA violations\n\nOn a practical note, implementing DiD in Stata is straightforward because in essence it's just a regression with an interaction term. The harder part is thinking through the assumptions and whether they're plausible for the case at hand.\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}